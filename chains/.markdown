# LangChain Chains & Runnables Guide

This folder contains notebooks demonstrating various chain patterns and runnable concepts in LangChain.

---

## Table of Contents

1. [Runnable Concept](#1-runnable-concept)
2. [Sequential Chain](#2-sequential-chain)
3. [Runnable Parallel](#3-runnable-parallel)
4. [Runnable Passthrough](#4-runnable-passthrough)
5. [Runnable Lambda](#5-runnable-lambda)
6. [Conditional Chain](#6-conditional-chain)
7. [Branch Runnable](#7-branch-runnable)

---

## 1. Runnable Concept

**File:** `runnable_concept.ipynb`

Introduction to the Runnable interface in LangChain - the foundation for building composable chains.

### Key Concepts

```python
from langchain_core.runnables import Runnable

# Every runnable has these core methods:
runnable.invoke(input)       # Single input
runnable.batch([inputs])     # Multiple inputs
runnable.stream(input)       # Streaming output
await runnable.ainvoke(input) # Async execution
```

### Runnable Interface Methods

| Method | Description |
|--------|-------------|
| `invoke()` | Process a single input |
| `batch()` | Process multiple inputs in parallel |
| `stream()` | Stream output tokens/chunks |
| `ainvoke()` | Async version of invoke |

---

## 2. Sequential Chain

**File:** `sequential_chain.ipynb`

Chains multiple runnables in sequence where output of one becomes input to the next.

### Example

```python
from langchain_core.prompts import ChatPromptTemplate
from langchain_groq import ChatGroq
from langchain_core.output_parsers import StrOutputParser

# Define prompts
prompt1 = ChatPromptTemplate.from_template("Write a summary of: {topic}")
prompt2 = ChatPromptTemplate.from_template("Translate to French: {text}")

model = ChatGroq(model="llama3-8b-8192")
parser = StrOutputParser()

# Sequential chain using pipe operator
chain = prompt1 | model | parser | prompt2 | model | parser

result = chain.invoke({"topic": "artificial intelligence"})
```

### Flow Diagram

```
Input → Prompt1 → Model → Parser → Prompt2 → Model → Parser → Output
```

---

## 3. Runnable Parallel

**File:** `runnable_parallel.ipynb`

Execute multiple runnables simultaneously and combine their outputs.

### Example

```python
from langchain_core.runnables import RunnableParallel

parallel_chain = RunnableParallel(
    summary=prompt_summary | model | parser,
    keywords=prompt_keywords | model | parser,
    sentiment=prompt_sentiment | model | parser
)

# All three run in parallel
result = parallel_chain.invoke({"text": "LangChain is amazing!"})
# Returns: {"summary": "...", "keywords": "...", "sentiment": "..."}
```

### Use Cases

- Generate multiple outputs from same input
- Reduce latency by parallelizing independent operations
- Create structured responses with multiple fields

---

## 4. Runnable Passthrough

**File:** `runnable_passthrough.ipynb`

Pass input data through unchanged, useful for preserving context in chains.

### Example

```python
from langchain_core.runnables import RunnablePassthrough, RunnableParallel

chain = RunnableParallel(
    context=retriever,                    # Gets documents
    question=RunnablePassthrough()        # Passes question unchanged
) | prompt | model | parser

result = chain.invoke("What is LangChain?")
```

### Common Patterns

```python
# Pass through with assignment
from langchain_core.runnables import RunnablePassthrough

chain = RunnablePassthrough.assign(
    context=lambda x: retriever.invoke(x["question"])
)
```

---

## 5. Runnable Lambda

**File:** `runnable_lambda.ipynb`

Convert any Python function into a runnable for custom transformations.

### Example

```python
from langchain_core.runnables import RunnableLambda

# Custom transformation function
def format_docs(docs):
    return "\n\n".join(doc.page_content for doc in docs)

# Convert to runnable
format_runnable = RunnableLambda(format_docs)

# Use in chain
chain = retriever | format_runnable | prompt | model | parser
```

### Use Cases

- Custom data preprocessing
- Output formatting/parsing
- Business logic integration
- API calls within chains

---

## 6. Conditional Chain

**File:** `conditionla_chain.ipynb`

Route execution based on conditions or input content.

### Example

```python
from langchain_core.runnables import RunnableBranch, RunnableLambda

def route(input):
    if "code" in input["question"].lower():
        return code_chain
    elif "math" in input["question"].lower():
        return math_chain
    else:
        return general_chain

conditional_chain = RunnableLambda(route)

# Or using RunnableBranch
chain = RunnableBranch(
    (lambda x: "code" in x["question"].lower(), code_chain),
    (lambda x: "math" in x["question"].lower(), math_chain),
    general_chain  # default
)
```

---

## 7. Branch Runnable

**File:** `branch_runnable.ipynb`

Advanced branching with multiple conditions and fallback routes.

### Example

```python
from langchain_core.runnables import RunnableBranch

branch = RunnableBranch(
    # Condition 1: Technical questions
    (
        lambda x: x["category"] == "technical",
        technical_prompt | model | parser
    ),
    # Condition 2: Sales questions
    (
        lambda x: x["category"] == "sales",
        sales_prompt | model | parser
    ),
    # Condition 3: Support questions
    (
        lambda x: x["category"] == "support",
        support_prompt | model | parser
    ),
    # Default fallback
    general_prompt | model | parser
)

result = branch.invoke({"category": "technical", "question": "How does API work?"})
```

### Flow Diagram

```
                    ┌─→ Technical Chain
                    │
Input → Condition ──┼─→ Sales Chain
                    │
                    ├─→ Support Chain
                    │
                    └─→ Default Chain
```

---

## Comparison Summary

| Pattern | Use Case | Execution |
|---------|----------|-----------|
| **Sequential** | Step-by-step processing | One after another |
| **Parallel** | Multiple independent tasks | Simultaneous |
| **Passthrough** | Preserve original input | Pass-through |
| **Lambda** | Custom functions | Inline transformation |
| **Conditional** | Route based on input | Single branch |
| **Branch** | Multi-way routing | Condition-based |

---

## Common Patterns

### RAG Chain

```python
chain = (
    RunnableParallel(
        context=retriever | format_docs,
        question=RunnablePassthrough()
    )
    | prompt
    | model
    | parser
)
```

### Multi-Step Processing

```python
chain = (
    RunnablePassthrough.assign(step1=chain1)
    | RunnablePassthrough.assign(step2=chain2)
    | final_chain
)
```

---

## Requirements

```bash
pip install langchain langchain-core langchain-groq langchain-community
```

---

## Environment Variables

```bash
GROQ_API_KEY=your_groq_api_key
```